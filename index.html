<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="au theme template">
    <meta name="author" content="Hau Nguyen">
    <meta name="keywords" content="au theme template">

    <!-- Title Page-->
    <title>GajahSafe - Dashboard</title>

    <!-- Fontfaces CSS-->
    <link href="css/font-face.css" rel="stylesheet" media="all">
    <link href="vendor/font-awesome-4.7/css/font-awesome.min.css" rel="stylesheet" media="all">
    <link href="vendor/font-awesome-5/css/fontawesome-all.min.css" rel="stylesheet" media="all">
    <link href="vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet" media="all">

    <!-- Bootstrap CSS-->
    <link href="vendor/bootstrap-4.1/bootstrap.min.css" rel="stylesheet" media="all">

    <!-- Vendor CSS-->
    <link href="vendor/animsition/animsition.min.css" rel="stylesheet" media="all">
    <link href="vendor/bootstrap-progressbar/bootstrap-progressbar-3.3.4.min.css" rel="stylesheet" media="all">
    <link href="vendor/wow/animate.css" rel="stylesheet" media="all">
    <link href="vendor/css-hamburgers/hamburgers.min.css" rel="stylesheet" media="all">
    <link href="vendor/slick/slick.css" rel="stylesheet" media="all">
    <link href="vendor/select2/select2.min.css" rel="stylesheet" media="all">
    <link href="vendor/perfect-scrollbar/perfect-scrollbar.css" rel="stylesheet" media="all">
    <link href="vendor/vector-map/jqvmap.min.css" rel="stylesheet" media="all">

    <!-- Main CSS-->
    <link href="css/theme.css" rel="stylesheet" media="all">

    <style>
        body {
            overflow: hidden; /* Prevent scrolling */
        }
        .main-content {
            height: 100vh;
            padding-top: 0px;
        }
        @media (max-width: 991px) {
            .header-desktop {
                position: fixed;
                left: 0;
                height: 45px;
                top: 85px;
                margin-top: 0;
            }
        }
    </style>
</head>

<body>
    <div class="page-wrapper">
        <!-- Include header-mobile.html -->
        <div data-include="header-mobile.html"></div>

        <!-- Include menu-sidebar.html -->
        <div data-include="menu-sidebar.html"></div>

        <!-- PAGE CONTAINER-->
        <div class="page-container">
            <!-- Include header-desktop.html -->
            <div data-include="header-desktop.html"></div>

            <!-- MAIN CONTENT -->
            <div class="main-content">
                <!-- Include language-modal.html -->
                <div data-include="language-modal.html"></div>
                <!-- GOOGLE MAP -->
                <div id="googleMapIndex" class="map-contentIndex"></div>
            </div>
            <!-- END MAIN CONTENT-->
        </div>
        <!-- END PAGE CONTAINER-->
    </div>

    <!-- Jquery JS-->
    <script src="vendor/jquery-3.2.1.min.js"></script>
    <!-- Bootstrap JS-->
    <script src="vendor/bootstrap-4.1/popper.min.js"></script>
    <script src="vendor/bootstrap-4.1/bootstrap.min.js"></script>
    <!-- Vendor JS       -->
    <script src="vendor/slick/slick.min.js"></script>
    <script src="vendor/wow/wow.min.js"></script>
    <script src="vendor/animsition/animsition.min.js"></script>
    <script src="vendor/bootstrap-progressbar/bootstrap-progressbar.min.js"></script>
    <script src="vendor/counter-up/jquery.waypoints.min.js"></script>
    <script src="vendor/counter-up/jquery.counterup.min.js"></script>
    <script src="vendor/circle-progress/circle-progress.min.js"></script>
    <script src="vendor/perfect-scrollbar/perfect-scrollbar.js"></script>
    <script src="vendor/chartjs/Chart.bundle.min.js"></script>
    <script src="vendor/select2/select2.min.js"></script>
    <script src="vendor/vector-map/jquery.vmap.js"></script>
    <script src="vendor/vector-map/jquery.vmap.min.js"></script>
    <script src="vendor/vector-map/jquery.vmap.sampledata.js"></script>
    <script src="vendor/vector-map/jquery.vmap.world.js"></script>
    <script src="vendor/vector-map/jquery.vmap.brazil.js"></script>
    <script src="vendor/vector-map/jquery.vmap.europe.js"></script>
    <script src="vendor/vector-map/jquery.vmap.france.js"></script>
    <script src="vendor/vector-map/jquery.vmap.germany.js"></script>
    <script src="vendor/vector-map/jquery.vmap.russia.js"></script>
    <script src="vendor/vector-map/jquery.vmap.usa.js"></script>

    <!-- Main JS-->
    <script src="js/main.js"></script>

    <!-- Google Map -->
    <script src="js/google_map_devices_index.js"></script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBM9c47J86uYl4dYw0NdwWdmE7BrwQ4xIc&callback=myMapDevicesIndex" async defer></script>

    <script>
        // Function to include HTML files
        $(function(){
            $('[data-include]').each(function(){
                var $this = $(this);
                $this.load($this.data('include'));
            });
        });
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Retrieve user data from sessionStorage
            const userData = JSON.parse(sessionStorage.getItem('userData'));

            if (userData) {
                // Update user information in the header
                document.getElementById('avatarImg').src = userData.avatar;
                document.getElementById('userName').textContent = userData.name;

                // Update user information in the dropdown
                document.getElementById('dropdownAvatarImg').src = userData.avatar;
                document.getElementById('dropdownUserName').textContent = userData.name;
                document.getElementById('dropdownUserEmail').textContent = userData.email;
            } else {
                // Redirect to login page if user data is not found
                window.location.href = 'login.html';
            }

            // Logout functionality
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', function(event) {
                    event.preventDefault(); // Prevent default link behavior

                    // Clear sessionStorage
                    sessionStorage.removeItem('userData');

                    // Redirect to login page
                    window.location.href = 'login.html';
                });
            }
        });
    </script>
    <script>
        // Function to change language
        function changeLanguage(lang) {
            localStorage.setItem('preferredLanguage', lang);
            loadLanguage(lang);
            document.getElementById('languageModal').style.display = "none"; // Hide modal after language change

            // Update button styles
            updateLanguageButtons(lang);
        }

        // Function to load language JSON
        async function loadLanguage(lang) {
            try {
                const response = await fetch(`languages/${lang}.json`);
                const translations = await response.json();
                document.querySelectorAll('[data-i18n]').forEach(element => {
                    const key = element.getAttribute('data-i18n');
                    if (translations[key]) {
                        element.textContent = translations[key];
                    }
                });
            } catch (error) {
                console.error('Error loading language:', error);
            }
        }

        // Function to load the preferred language from localStorage
        function loadPreferredLanguage() {
            const preferredLanguage = localStorage.getItem('preferredLanguage') || 'ms';
            loadLanguage(preferredLanguage);
            updateLanguageButtons(preferredLanguage);
        }

        // Function to update language buttons styles
        function updateLanguageButtons(lang) {
            const enButton = document.getElementById('langBtnEn');
            const msButton = document.getElementById('langBtnMs');

            if (lang === 'en') {
                enButton.classList.add('active-language');
                enButton.classList.remove('inactive-language');
                msButton.classList.add('inactive-language');
                msButton.classList.remove('active-language');
            } else if (lang === 'ms') {
                msButton.classList.add('active-language');
                msButton.classList.remove('inactive-language');
                enButton.classList.add('inactive-language');
                enButton.classList.remove('active-language');
            }
        }

        // Call this function on page load
        document.addEventListener('DOMContentLoaded', () => {
            loadPreferredLanguage();

            // Get the modal
            var modal = document.getElementById("languageModal");

            // Get the button that opens the modal
            var btn = document.getElementById("languageSwitchBtn");

            // Get the <span> element that closes the modal
            var span = document.getElementsByClassName("close")[0];

            // When the user clicks the button, open the modal 
            btn.onclick = function() {
                modal.style.display = "block";
            }

            // When the user clicks on <span> (x), close the modal
            span.onclick = function() {
                modal.style.display = "none";
            }

            // When the user clicks anywhere outside of the modal, close it
            window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
        });
    </script>

</body>

</html>
